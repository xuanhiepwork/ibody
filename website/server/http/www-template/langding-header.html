<header class="header">
  <style>
    .user-menu {
      display: none;
    }

    body:not(.user-loged-in) .require-user-loged-in  {
      display: none;
    }

    .user-loged-in .nav .login-btn {
      display: none;
    }

    .user-loged-in .nav .user-menu {
      display: inline-block;
    }

    .nav .user-menu .user-name {
      font-weight: 800;
    }
  </style>

  <a class="logo" href="/">
    <img src="/static/img/logo_color.png" alt="Logo IBODY" class="logo-image" />
    <span class="brand">IBODY</span>
  </a>

  <button name="menu-toggle" class="menu-toggle">â˜°</button>

  <script>{
      const base = document.createElement("div")
      base.innerHTML = `<nav class="nav">
  <a href="https://www.facebook.com/groups/1385192975848986/"><img src="/static/img/facebook-f-logo.svg" style="height: 1em; margin-right: .5em; display: inline-block;">Cá»™ng Ä‘á»“ng</a>
  <a href="/">Trang chá»§</a>
  <a href="/tim-chuyen-gia">TÆ° váº¥n</a>
  <a class="require-user-loged-in" href="/user/tin-nhan-user">ğŸ—¨ Tin nháº¯n</a>
  <a class="require-user-loged-in" href="/user/lich-hen-user">Lá»‹ch háº¹n</a>
  <a class="require-user-loged-in" href="/user/lich-su-goi">Lá»‹ch sá»­ giao dá»‹ch</a>
  <a href="/user/dang-ky-goi">GÃ³i tÆ° váº¥n</a>
  <a class="require-user-loged-in" href="/Admin/admin-users.html">NgÆ°á»i dÃ¹ng</a>
  <a href="#" class="login-btn" name="login-btn">ÄÄƒng nháº­p/ÄÄƒng kÃ½</a>

  <div class="user-menu" name="user-menu">
    <div class="user-button" name="user-button">
      <img name="user-avata" src="/static/img/default-avatar.jpg" alt="Avatar" class="avatar">
      <span class="user-name" name="user-name"></span>
      <div class="user-dropdown" name="userDropdown">
        <a href="/profile">Trang cÃ¡ nhÃ¢n</a>
        <a href="/user/become-expert">NÃ¢ng cáº¥p thÃ nh chuyÃªn gia</a>
        <a href="/tracnghiem">Tráº¯c nghiá»‡m tráº§m cáº£m</a>
        <a href="/user/ho-tro-user">Há»— trá»£</a>
        <a href="#" name="logout-btn">ÄÄƒng xuáº¥t</a>
      </div>
    </div>
  </div>
</nav>`

      const elm = base.firstElementChild
      const { pathname } = location
      const aElms = elm.querySelectorAll("a")
      var activated = false

      for (var i = aElms.length - 1, e; i >= 0; i--) {
        e = aElms[i]
        if (pathname === e.getAttribute("href")) {
          e.classList.add('active')
          activated = true
          break
        }
      }

      if (!activated) for (var i = aElms.length - 1, e; i >= 0; i--) {
        e = aElms[i]
        if (pathname.startsWith(e.getAttribute("href"))) {
          e.classList.add('active')
          break
        }
      }

      const dropdown = elm.querySelector("[name=userDropdown]")
      elm.querySelector("[name=user-button]").addEventListener("click", () => dropdown.classList.toggle("show"))

      const userMenu = elm.querySelector("[name=user-menu]")
      document.addEventListener("click", function (e) {
        if (!userMenu.contains(e.target)) dropdown.classList.remove("show")
      });

      elm.querySelector("[name=login-btn]").addEventListener("click", async () => import('/static/cpm/AuthModal.mjs').then(({ open }) => open()))
      elm.querySelector("[name=logout-btn]").addEventListener("click", async () => import('/static/js/auth.mjs').then(({ logout }) => logout()))

      if (ctx.user?.id) {
        document.body.classList.add("user-loged-in")
        elm.querySelector("[name=user-name]").innerText = ctx.user.fullname
        if (ctx.user.avatarUrl) {
          elm.querySelector("[name=user-avata]").setAttribute("src", ctx.user.avatarUrl)
        }
      }

      const header = document.currentScript.parentElement
      header.querySelector("[name=menu-toggle]").addEventListener("click", () => elm.classList.toggle("open"));
      // #TODO: fix loi ui chua áº©n hiá»‡n theo toggle (trÆ°á»ng há»£p mÃ n hÃ¬nh cÃ³ width nhá»)

      document.currentScript.parentElement.append(elm)
    }</script>

</header>