<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hồ sơ của tôi - IBODY</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

  <style>
    :root {
      --primary-color: #A993EC;
      --primary-color-light: rgba(169, 147, 236, 0.1);
      --success-color: #28a745;
      --danger-color: #dc3545;
      --info-color: #0d6efd;
      --sidebar-bg: #ffffff;
      --main-bg: #f8f7fc;
      --card-bg: #ffffff;
      --border-color: #eef0f4;
      --text-primary: #1a202c;
      --text-secondary: #718096;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background-color: var(--bg-light); color: var(--text-primary); }
    
    /* --- General Layout & Components --- */
    .header { background-color: var(--card-bg); box-shadow: 0 2px 4px rgba(0,0,0,0.05); padding: 0 5%; display: flex; justify-content: space-between; align-items: center; height: 70px; }
    .header .logo { font-weight: 700; font-size: 1.5rem; color: var(--primary-color); }
    .header .nav a { text-decoration: none; color: var(--text-secondary); font-weight: 600; }
    
    .main-container { max-width: 1100px; margin: 40px auto; padding: 0 20px; }
    .page-header h1 { font-size: 2rem; font-weight: 700; margin-bottom: 25px; }
    .profile-layout { display: grid; grid-template-columns: 280px 1fr; gap: 30px; align-items: flex-start; }
    .content-card { background-color: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; padding: 25px; }
    .content-card h3 { font-size: 1.5rem; margin-top: 0; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
    .form-btn { padding: 12px 25px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; background-color: var(--primary-color); color: white; transition: background-color 0.2s; }
    .form-btn:hover { background-color: #937dce; }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; font-weight: 600; margin-bottom: 8px; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); background-color: var(--bg-light); font-size: 1rem; }
    .form-hint { font-size: 0.85rem; color: var(--text-secondary); margin-top: 8px; }
    
    /* --- Profile Menu --- */
    .profile-menu { background-color: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; padding: 15px; }
    .user-card { text-align: center; padding-bottom: 20px; margin-bottom: 15px; border-bottom: 1px solid var(--border-color); }
    .user-card img { width: 80px; height: 80px; border-radius: 50%; margin-bottom: 10px; }
    .user-card .name { font-weight: 700; font-size: 1.2rem; }
    .user-card .email { font-size: 0.9rem; color: var(--text-secondary); }
    .profile-menu .nav-list { list-style: none; padding: 0; }
    .profile-menu .nav-link { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px; text-decoration: none; color: var(--text-secondary); font-weight: 600; margin-bottom: 5px; position: relative; }
    .profile-menu .nav-link:hover { background-color: var(--bg-light); }
    .profile-menu .nav-link.active { background-color: var(--primary-color); color: white; }
    .profile-menu .nav-link i { width: 20px; text-align: center; }
    .unread-dot { width: 8px; height: 8px; background-color: #dc3545; border-radius: 50%; position: absolute; right: 12px; top: 50%; transform: translateY(-50%); }

    /* --- Tab Content --- */
    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* History Tab */
    .history-item { display: flex; gap: 15px; padding: 15px 0; border-bottom: 1px solid var(--border-color); align-items: center; justify-content: space-between; }
    .history-item:last-child { border-bottom: none; }
    .history-item-info { display: flex; align-items: center; gap: 15px; text-decoration: none; }
    .history-item-info img { width: 50px; height: 50px; border-radius: 50%; }
    .history-item-info .expert-name { font-weight: 600; color: var(--text-primary); transition: color 0.2s; }
    .history-item-info:hover .expert-name { color: var(--primary-color); }
    .history-item-info .details { font-size: 0.9rem; color: var(--text-secondary); }
    .btn-review { background-color: var(--success-color); color: white; padding: 8px 15px; border-radius: 6px; text-decoration: none; border: none; font-weight: 600; cursor: pointer; }

    /* Package Tab */
    .package-card { background: linear-gradient(45deg, var(--primary-color), #7A63D8); color: white; border-radius: 12px; padding: 20px; }
    .package-card h4 { margin-top: 0; }
    .progress-bar { background-color: rgba(0,0,0,0.2); border-radius: 20px; height: 10px; width: 100%; margin: 10px 0; }
    .progress-bar-fill { background-color: #ffffff; height: 100%; border-radius: 20px; }
    .btn-manage-package { display: inline-block; margin-top: 15px; background-color: white; color: var(--primary-color); padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; }
    
    /* Notification Tab */
    .notification-list { list-style: none; padding: 0; }
    .notification-item { display: flex; gap: 15px; padding: 15px; border-radius: 8px; margin-bottom: 10px; text-decoration: none; color: inherit; transition: background-color 0.2s; }
    .notification-item:hover { background-color: var(--bg-light); }
    .notification-item.unread { background-color: var(--primary-color-light); }
    .notification-item .icon { font-size: 1.5rem; }
    .notification-item .content .message { font-weight: 500; color: var(--text-primary); }
    .notification-item .content .timestamp { font-size: 0.85rem; color: var(--text-secondary); }

    /* Upgrade Tab */
    .progress-bar-upgrade { display: flex; justify-content: space-between; margin-bottom: 30px; position: relative; }
    .progress-bar-upgrade::before {
    content: '';
    position: absolute;
    top: 16px; /* Căn giữa vòng tròn 32px */
    left: 0;
    right: 0;
    height: 4px;
    background-color: var(--border-color);
    transform: translateY(-50%);
    z-index: 1; /* Nằm ở lớp 1 */
}

.progress-indicator {
    position: absolute;
    top: 16px; /* Căn giữa vòng tròn 32px */
    left: 0;
    height: 4px;
    background-color: var(--primary-color);
    transform: translateY(-50%);
    z-index: 2; /* Nằm trên lớp 1 */
    transition: width 0.4s ease;
}

.step {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    color: var(--text-secondary);
    font-weight: 600;
    position: relative; /* Cần thiết cho z-index */
    z-index: 3; /* Nằm trên lớp 2, cao nhất */
    background-color: var(--card-bg); /* Che đi đường kẻ phía sau chữ */
    padding: 0 5px; /* Tạo khoảng trống nhỏ */
}

.step-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: var(--card-bg); /* Nền để che đường kẻ bên dưới */
    border: 2px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.4s ease;
}
.step.active .step-icon { background-color: var(--primary-color); border-color: var(--primary-color); color: white; }
    .form-buttons { display: flex; justify-content: space-between; margin-top: 30px; }
    .success-message { text-align: center; }
    .success-message .icon { font-size: 3rem; color: var(--success-color); }
    .success-message a.form-btn { margin-top: 20px; text-decoration:none; display: inline-flex; }

    @media (max-width: 900px) { .profile-layout { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <header class="header">...</header>

  <div class="main-container">
    <div class="page-header"> <h1>Cài đặt Tài khoản</h1> </div>
    <div class="profile-layout">
        <aside class="profile-menu">
            <div class="user-card">
                <img id="menuAvatar" alt="Avatar">
                <div id="menuName" class="name"></div>
            </div>
            <ul class="nav-list">
                <li><a href="#" class="nav-link active" data-tab="info"><i class="fas fa-user-circle"></i> Thông tin cá nhân</a></li>
                <li><a href="#" class="nav-link" data-tab="package"><i class="fas fa-box-open"></i> Gói dịch vụ</a></li>
                <li><a href="#" class="nav-link" data-tab="history"><i class="fas fa-history"></i> Lịch sử tư vấn</a></li>
                <li><a href="#" class="nav-link" data-tab="notifications"><i class="fas fa-bell"></i> Thông báo</a></li>
                <li><a href="#" class="nav-link" data-tab="upgrade"><i class="fas fa-rocket"></i> Nâng cấp tài khoản</a></li>
            </ul>
        </aside>

        <main class="tab-content-area">
            <div id="info" class="tab-content active">
                 <div class="content-card">
                    <h3>Chỉnh sửa thông tin</h3>
                    <form id="updateInfoForm">
                        <div class="form-group">
                            <label for="hoTen">Họ tên</label>
                            <input type="text" id="hoTen" required>
                        </div>
                        <div class="form-group">
                            <label for="ngaySinh">Ngày sinh</label>
                            <input type="date" id="ngaySinh">
                        </div>
                        <div class="form-group">
                            <label for="gioiTinh">Giới tính</label>
                            <select id="gioiTinh">
                                <option value="nam">Nam</option>
                                <option value="nu">Nữ</option>
                                <option value="khac">Khác</option>
                            </select>
                        </div>
                         <div class="form-group">
                            <label for="mucTieuTamLy">Mục tiêu tâm lý</label>
                            <textarea id="mucTieuTamLy" rows="3" placeholder="Chia sẻ ngắn gọn về điều bạn muốn cải thiện..."></textarea>
                        </div>
                        <button type="submit" class="form-btn">Lưu thay đổi</button>
                    </form>
                 </div>
            </div>
            <div id="package" class="tab-content">
                <div class="content-card">
                    <h3>Gói dịch vụ của bạn</h3>
                    <div class="package-card">
                        <h4 id="packageName"></h4>
                        <p>Số lượt tư vấn còn lại:</p>
                        <div class="progress-bar"><div class="progress-bar-fill" id="progressFill"></div></div>
                        <p id="progressLabel" style="text-align:right; font-weight:600;"></p>
                        <p>Ngày hết hạn: <strong id="expiryDate"></strong></p>
                        <a href="#" class="btn-manage-package">Quản lý & Mua thêm Gói</a>
                    </div>
                </div>
            </div>
            <div id="history" class="tab-content">
                <div class="content-card">
                    <h3>Lịch sử các buổi tư vấn</h3>
                    <div id="lichSuTuVanList"></div>
                </div>
            </div>
            <div id="notifications" class="tab-content">
                 <div class="content-card">
                    <h3>Thông báo</h3>
                    <div id="notificationList" class="notification-list"></div>
                </div>
            </div>
            <div id="upgrade" class="tab-content">
                <div class="content-card">
                    <div id="formWrapper">
                        <h3>Nâng cấp thành Chuyên gia</h3>
                        <div class="progress-bar-upgrade">
                           <div class="progress-indicator" id="progressIndicator"></div>
                           <div class="step active" id="step1"> <div class="step-icon">1</div> <span>Cơ bản</span> </div>
                           <div class="step" id="step2"> <div class="step-icon">2</div> <span>Chuyên môn</span> </div>
                           <div class="step" id="step3"> <div class="step-icon">3</div> <span>Xác minh</span> </div>
                        </div>
                        <form id="upgradeForm">
                            <div class="form-step active" data-step="0">
                                <div class="form-group"><label for="fullName">Họ và Tên</label><input type="text" id="fullName" required></div>
                                <div class="form-group"><label for="introduction">Giới thiệu bản thân</label><textarea id="introduction" rows="5" required></textarea><p class="form-hint"><i class="fas fa-info-circle"></i> Gợi ý: Hãy chia sẻ về triết lý làm việc của bạn.</p></div>
                                <div class="form-buttons"><span></span><button type="button" class="form-btn btn-next">Tiếp theo <i class="fas fa-arrow-right"></i></button></div>
                            </div>
                            <div class="form-step" data-step="1">
                                <div class="form-group"><label for="specialty">Lĩnh vực chuyên môn chính</label><input type="text" id="specialty" required><p class="form-hint"><i class="fas fa-info-circle"></i> Lĩnh vực này sẽ được hiển thị nổi bật trên hồ sơ.</p></div>
                                <div class="form-group"><label for="experienceYears">Số năm kinh nghiệm</label><input type="number" id="experienceYears" min="0" required></div>
                                <div class="form-buttons"><button type="button" class="form-btn btn-prev"><i class="fas fa-arrow-left"></i> Quay lại</button><button type="button" class="form-btn btn-next">Tiếp theo <i class="fas fa-arrow-right"></i></button></div>
                            </div>
                            <div class="form-step" data-step="2">
                                <div class="form-group"><label for="certificates">Bằng cấp & Chứng chỉ</label><textarea id="certificates" rows="3" required></textarea><p class="form-hint"><i class="fas fa-info-circle"></i> Mỗi bằng cấp/chứng chỉ trên một dòng.</p></div>
                                <div class="form-group"><label for="certificateImage">Tải lên ảnh chứng chỉ</label><input type="file" id="certificateImage" style="display: none;"><div class="file-upload-area" id="fileUploadArea"><i class="fas fa-cloud-upload-alt"></i><p>Nhấn để chọn ảnh</p></div><div id="image-preview"></div></div>
                                <div class="form-buttons"><button type="button" class="form-btn btn-prev"><i class="fas fa-arrow-left"></i> Quay lại</button><button type="submit" class="form-btn btn-submit"><i class="fas fa-check-circle"></i> Gửi yêu cầu</button></div>
                            </div>
                        </form>
                    </div>
                    <div id="successMessage" class="success-message" style="display: none;">
                        <div class="icon"><i class="fas fa-check-circle"></i></div>
                        <h2>Gửi yêu cầu thành công!</h2>
                        <p>Bước tiếp theo, vui lòng cập nhật phương thức thanh toán.</p>
                        <a href="#" class="form-btn">Cài đặt Thanh toán</a>
                    </div>
                </div>
            </div>
        </main>
    </div>
  </div>
  
<div id="toast-container"></div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // --- Mock Data ---
    const mockUser = { name: 'Nguyễn Thu An', avatar: 'https://i.pravatar.cc/150?u=client1', email: 'thuan.nguyen@email.com', dob: '2002-10-15', gender: 'nu', goal: 'Học cách quản lý stress.'};
    const mockPackage = { name: 'Premium+', remaining: 35, total: 50, expiry: '08/06/2026' };
    const mockHistory = [
        { id: 1, expertId: 2, expertName: 'Hồ Hoàng Yến', avatar: 'https://i.pravatar.cc/150?u=expert2', date: '01/06/2025', reviewed: true },
        { id: 2, expertId: 3, expertName: 'Vũ Phương Thảo', avatar: 'https://i.pravatar.cc/150?u=expert3', date: '25/05/2025', reviewed: false },
    ];
    const mockNotifications = [
        { icon: 'fa-calendar-check', color: 'var(--success-color)', message: 'Chuyên gia Hồ Hoàng Yến đã xác nhận lịch hẹn của bạn.', timestamp: '2 giờ trước', isRead: false, link: 'lich-hen-user.html' },
        { icon: 'fa-credit-card', color: 'var(--primary-color)', message: 'Gia hạn gói Premium+ thành công.', timestamp: '1 ngày trước', isRead: true, link: 'dang-ky-goi.html' },
    ];

    // --- References ---
    const navLinks = document.querySelectorAll('.nav-link');
    const tabContents = document.querySelectorAll('.tab-content');

    // --- Toast Notification Logic ---
    function showToast(message, type = 'success') {
        const container = document.getElementById('toast-container') || document.createElement('div');
        if(!document.getElementById('toast-container')) {
            container.id = 'toast-container';
            document.body.appendChild(container);
        }
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        const icons = { success: 'fa-check-circle', danger: 'fa-times-circle' };
        toast.innerHTML = `<i class="fas ${icons[type]} toast-icon"></i><span class="toast-message">${message}</span>`;
        container.appendChild(toast);
        setTimeout(() => toast.remove(), 4000);
    }

    // --- Render Functions ---
    function renderProfileMenu() {
        document.getElementById('menuAvatar').src = mockUser.avatar;
        document.getElementById('menuName').textContent = mockUser.name;
        document.getElementById('hoTen').value = mockUser.name;
        document.getElementById('ngaySinh').value = mockUser.dob;
        document.getElementById('gioiTinh').value = mockUser.gender;
        document.getElementById('mucTieuTamLy').value = mockUser.goal;
    }
    
    function renderPackageInfo() {
        document.getElementById('packageName').textContent = `Gói dịch vụ: ${mockPackage.name}`;
        const progress = (mockPackage.remaining / mockPackage.total) * 100;
        document.getElementById('progressFill').style.width = `${progress}%`;
        document.getElementById('progressLabel').textContent = `${mockPackage.remaining}/${mockPackage.total} lượt`;
        document.getElementById('expiryDate').textContent = mockPackage.expiry;
    }

    function renderHistory() {
        const historyList = document.getElementById('lichSuTuVanList');
        historyList.innerHTML = '';
        mockHistory.forEach(item => {
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            const actionButton = item.reviewed ? `<span style="color: var(--text-secondary);">Đã đánh giá</span>` : `<a href="#" class="btn-review">Đánh giá</a>`;
            historyItem.innerHTML = `
                <a href="#" class="history-item-info" title="Xem hồ sơ chuyên gia ${item.expertName}">
                    <img src="${item.avatar}" alt="Avatar">
                    <div class="info"><div class="expert-name">${item.expertName}</div><div class="details">Ngày tư vấn: ${item.date}</div></div>
                </a>
                <div class="history-actions">${actionButton}</div>`;
            historyList.appendChild(historyItem);
        });
    }
    
    function renderNotifications() {
        const notificationList = document.getElementById('notificationList');
        notificationList.innerHTML = '';
        mockNotifications.forEach(n => {
            const item = document.createElement('a');
            item.href = n.link;
            item.className = `notification-item ${!n.isRead ? 'unread' : ''}`;
            item.innerHTML = `<div class="icon"><i class="fas ${n.icon}" style="color: ${n.color};"></i></div> <div class="content"> <div class="message">${n.message}</div> <div class="timestamp">${n.timestamp}</div> </div>`;
            notificationList.appendChild(item);
        });
        const unreadCount = mockNotifications.filter(n => !n.isRead).length;
        const notificationLink = document.querySelector('.nav-link[data-tab="notifications"]');
        const unreadDot = notificationLink.querySelector('.unread-dot');
        if (unreadCount > 0 && !unreadDot) {
            notificationLink.innerHTML += '<span class="unread-dot"></span>';
        } else if (unreadCount === 0 && unreadDot) {
            unreadDot.remove();
        }
    }

    // --- Tab Switching Logic ---
    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            if (link.dataset.tab) {
                e.preventDefault();
                const tabId = link.dataset.tab;
                navLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                tabContents.forEach(content => {
                    content.classList.toggle('active', content.id === tabId);
                });
            }
        });
    });

    // --- Update Info Form Logic ---
     document.getElementById('updateInfoForm').addEventListener('submit', (e) => {
        e.preventDefault();
        showToast('Cập nhật thông tin thành công!', 'success');
     });

    // --- Upgrade Form Logic ---
    const upgradeFormSteps = document.querySelectorAll('#upgrade .form-step');
    const upgradeStepIndicators = document.querySelectorAll('#upgrade .step');
    const upgradeProgressIndicator = document.getElementById('progressIndicator');
    let upgradeCurrentStep = 0;

    function updateUpgradeProgress() {
        upgradeStepIndicators.forEach((step, index) => step.classList.toggle('active', index <= upgradeCurrentStep));
        if(upgradeProgressIndicator) {
            upgradeProgressIndicator.style.width = `${(upgradeCurrentStep / (upgradeFormSteps.length - 1)) * 100}%`;
        }
    }

    function showUpgradeStep(stepIndex) {
        upgradeFormSteps.forEach((step, index) => step.classList.toggle('active', index === stepIndex));
        upgradeCurrentStep = stepIndex;
        updateUpgradeProgress();
    }
    
    document.querySelectorAll('#upgrade .btn-next').forEach(b => b.addEventListener('click', () => showUpgradeStep(upgradeCurrentStep + 1)));
    document.querySelectorAll('#upgrade .btn-prev').forEach(b => b.addEventListener('click', () => showUpgradeStep(upgradeCurrentStep - 1)));
    
    document.getElementById('upgradeForm').addEventListener('submit', (e) => {
        e.preventDefault();
        document.getElementById('formWrapper').style.display = 'none';
        document.getElementById('successMessage').style.display = 'block';
    });
    
    document.querySelector('#upgrade #fullName').value = mockUser.name;

    // --- Initial Render ---
    renderProfileMenu();
    renderPackageInfo();
    renderHistory();
    renderNotifications();
});
</script>
</body>
</html>